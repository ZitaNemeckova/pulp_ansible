# WARNING: DO NOT EDIT!
#
# This file was generated by plugin_template, and is managed by bootstrap.py. Please use
# bootstrap.py to update this file.
#
# For more info visit https://github.com/pulp/plugin_template

sudo: required
# https://docs.travis-ci.com/user/trusty-ci-environment/
dist: xenial
language: python
python:
    # python versions used in el7 SCL & supported fedora
    - "3.6"
    - "3.7"
env:
  matrix:
    - TEST=pulp
    - TEST=docs
    - TEST=bindings
matrix:
  exclude:
    - python: '3.7'
      env: TEST=bindings
    - python: '3.6'
      env: TEST=docs
  fast_finish: true
services:
    - postgresql
    - redis-server
addons:
  apt:
    packages:
      - httpie
      - jq
  # postgres versions provided by el7 RHSCL (lowest supportable version)
  postgresql: '9.6'
before_install: .travis/before_install.sh
install: .travis/install.sh
before_script: PULP_SETTINGS=/etc/pulp/settings.py .travis/before_script.sh
script: PULP_SETTINGS=/etc/pulp/settings.py .travis/script.sh
after_failure:
  - sh -c "cat ~/django_runserver.log"
  - sh -c "cat ~/resource_manager.log"
  - sh -c "cat ~/reserved_workers-1.log"
jobs:
  include:
  - stage: deploy-plugin-to-pypi
    script:  PULP_SETTINGS=/etc/pulp/settings.py bash .travis/publish_plugin_pypi.sh
    if: tag IS present

  - stage: publish-daily-client-gem
    script: PULP_SETTINGS=/etc/pulp/settings.py bash .travis/publish_client_gem.sh
    env:
      - TEST=bindings
    if: type = cron
  - stage: publish-daily-client-pypi
    script: PULP_SETTINGS=/etc/pulp/settings.py bash .travis/publish_client_pypi.sh
    env:
      - TEST=bindings
    if: type = cron
  - stage: publish-client-gem
    script: PULP_SETTINGS=/etc/pulp/settings.py bash .travis/publish_client_gem.sh
    env:
      - TEST=bindings
    if: tag IS present
  - stage: publish-client-pypi
    script: PULP_SETTINGS=/etc/pulp/settings.py bash .travis/publish_client_pypi.sh
    env:
      - TEST=bindings
    if: tag IS present

notifications:
  irc:
    channels:
    - chat.freenode.net#pulp-ansible
    on_failure: always
    on_success: change


